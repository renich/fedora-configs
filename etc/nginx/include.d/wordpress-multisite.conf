# WordPress multisite subdirectory rules.
# Designed to be included in any server {} block.
# src: http://codex.wordpress.org/Nginx#WordPress_Multisite_Subdirectory_rules

if (!-e $request_filename) {
        rewrite /wp-admin$ $scheme://$host$uri/ permanent;
        rewrite ^(/[^/]+)?(/wp-.*) $2 last;
        rewrite ^/[^/]+(/.*.php)$ $1 last;
}

location ~ \.php$ {
    try_files $uri /index.php;

    include /etc/nginx/fastcgi_params;

    fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock;
    fastcgi_cache_bypass $skip_cache;
    fastcgi_no_cache $skip_cache;
    fastcgi_cache WORDPRESS;
    fastcgi_cache_valid  60m;
}
